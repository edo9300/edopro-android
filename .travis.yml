language: android
os: linux
dist: xenial
git:
  depth: 1
env:
  global:
  - MINIO_UPLOAD=$(date +%Y-%m-%d_%H-%M-$TRAVIS_COMMIT)
  - DEPLOY_DIR=release
  - DEPLOY_BRANCH=android
  - LIBWINDBOT_URL=https://github.com/ProjectIgnis/windbot/releases/download/20200522/libWindbot.aar
  - LIBWINDBOT_RESOURCES=https://github.com/ProjectIgnis/windbot/releases/download/20200522/WindBotIgnite-Resources.7z
android:
  components:
  - platform-tools
  - tools
  - build-tools-29.0.3
  - android-28
install: yes | sdkmanager ndk-bundle
before_script:
- mkdir -p libs
- curl --retry 5 --connect-timeout 30 --location --remote-header-name -o libs/libWindbot.aar $LIBWINDBOT_URL
script:
- echo "sdk.dir=$ANDROID_HOME" > local.properties
- $ANDROID_HOME/ndk-bundle/ndk-build -j2
- $ANDROID_HOME/ndk-bundle/ndk-build -C deps/ocgcore -j2
- ./ci/download-assets.sh
- ./ci/finalize-assets.sh
- ./gradlew assemble
before_deploy:
- ./ci/sign-release.sh
- mkdir -p "$MINIO_UPLOAD"
- cp release/*.apk "$MINIO_UPLOAD"
deploy:
- provider: script
  skip_cleanup: true
  script: bash ./ci/travis-minio.sh
